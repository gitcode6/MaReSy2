@page
@using Microsoft.AspNetCore.Authorization
@model LagerverwaltungModel
@{
    ViewData["Title"] = "Lagerverwaltung";
}
@attribute [Authorize(Policy = "AdminsOnly")]
<style>
    .lagerverwaltung_lagerverwaltung {
        background-color: #403A60;
        padding-top: 10px;
        padding-bottom: 1px;
        text-align: center;
        font-family: Dunant;
    }

    .table_detail {
        padding: 2%;
        width: 100%;
        font-family: Dunant;
    }
</style>

<div class="lagerverwaltung_lagerverwaltung">
    <h1 style="color: white; font-size:50px;">Lager-Verwaltung</h1>
</div>

<div class="table_detail">
    <table class="table">
        <thead>
            <tr style="vertical-align: middle;">
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th>
                    <a class="btn btn-primary" asp-page="/LagerverwaltungEP" style="background-color: #403A60; border: #403A60;">Einzelprodukte verwalten</a>
                </th>
            </tr>
            <tr style="vertical-align: middle;">
                <th>Filter</th>
                <th><input type="text" id="searchInputBezeichnung" onkeyup="filterTable()" placeholder="Bezeichnung"></th>
                <th><input type="text" id="searchInputBeschreibung" onkeyup="filterTable()" placeholder="Beschreibung"></th>
                <th>
                    <select id="statusFilter" onchange="filterTable()">
                        <option value="">Alle</option>
                        <option value="Aktiv">Aktiv</option>
                        <option value="Inaktiv">Inaktiv</option>
                    </select>
                </th>
                <th>
                    <a class="btn btn-primary" asp-page="/LagerverwaltungHinzufügen" style="background-color: #A0DAB3; border: #A0DAB3;">Produkt hinzufügen</a>
                    <a class="btn btn-primary" asp-page="/LagerverwaltungHinzufügungSet" style="background-color: #A0DAB3; border: #A0DAB3;">Set hinzufügen</a>
                </th>
            </tr>
            <tr style="vertical-align: middle;">
                <th width="4%">ID</th>
                <th width="21%">Bezeichnung</th>
                <th width="40%">Beschreibung</th>
                <th width="4%">Status</th>
                <th width="24%">Tools</th>
            </tr>
        </thead>
        <tbody id="userTableBody">

            @foreach (var e in Model.products)
            {
                <tr style="vertical-align: middle;">
                    <td>P @e.productId</td>
                    <td>@e.productname</td>
                    <td>@e.productdescription</td>
                    <td>@(e.productactive ? "Aktiv" : "Inaktiv")</td>
                    <td>
                        <a class="btn btn-primary" asp-page="/LagerverwaltungBearbeiten" asp-route-id="@e.productId" asp-route-produktname="@e.productname" asp-route-produktbeschreibung="@e.productdescription" asp-route-produktbild="C:\Users\a.schmidt3\Documents\GitHub\MaReSy2\Frontend\wwwroot\images\Übungsmedikament1.png" asp-route-status="@(e.productactive ? "Aktiv" : "Inaktiv")" style="background-color: #403A60;border-color:#403A60;">Bearbeiten</a>
                        <a class="btn btn-danger" asp-page="/Delete" asp-route-id="@e.productId" style="background-color: #B70E0C; border-color:#B70E0C;">Löschen</a>



                    </td>
                </tr>
            }

            <!--HIER KOMMT ZWEITER FOREACH REIN-->
            <tr style="vertical-align: middle;">
                <td>S 1</td>
                <td>BewerbsSet</td>
                <td>Dies ist die optimale Konfiguration für den Bewerb.</td>
                <td>Aktiv</td>
                <td>
                    <!-- BEARBEITEN UND LÖSCHEN BUTTONS -->
                    <a class="btn btn-primary" asp-page="/LagerverwaltungBearbeitenSET" asp-route-id="S 1" asp-route-setname="BewerbSset" asp-route-setbeschreibung="Dies ist die optimale Konfiguration für den Bewerb." asp-route-pfadbild="~/images/Übungsmedikament1.JPG" asp-route-setmenge="3" asp-route-setstatus="Aktiv" style="background-color: #403A60; border-color:#403A60;">Bearbeiten</a>
                    <a class="btn btn-danger" asp-page="/Delete" asp-route-id="S 1" style="background-color: #B70E0C; border-color:#B70E0C;">Löschen</a>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    function filterTable() {
        // Variablen
        var inputBezeichnung = document.getElementById("searchInputBezeichnung").value.toUpperCase();
        var inputBeschreibung = document.getElementById("searchInputBeschreibung").value.toUpperCase();
        var statusFilter = document.getElementById("statusFilter").value;
        var table = document.getElementById("userTableBody");
        var tr = table.getElementsByTagName("tr");

        // Schleife über alle Zeilen in der Tabelle
        for (var i = 0; i < tr.length; i++) {
            var tdBezeichnung = tr[i].getElementsByTagName("td")[1];
            var tdBeschreibung = tr[i].getElementsByTagName("td")[2];
            var tdStatus = tr[i].getElementsByTagName("td")[3];
            var match = true; // Initialisiere match als true

            // Überprüfen auf Übereinstimmungen für Bezeichnung und Beschreibung
            if (tdBezeichnung) {
                var txtBezeichnung = tdBezeichnung.textContent || tdBezeichnung.innerText;
                if (txtBezeichnung.toUpperCase().indexOf(inputBezeichnung) === -1) {
                    match = false;
                }
            }

            if (tdBeschreibung) {
                var txtBeschreibung = tdBeschreibung.textContent || tdBeschreibung.innerText;
                if (txtBeschreibung.toUpperCase().indexOf(inputBeschreibung) === -1) {
                    match = false;
                }
            }

            // Überprüfen auf Status-Übereinstimmung
            if (tdStatus && statusFilter) {
                var txtStatus = tdStatus.textContent || tdStatus.innerText;
                if (txtStatus !== statusFilter) {
                    match = false;
                }
            }

            // Zeile ein- oder ausblenden
            tr[i].style.display = match ? "" : "none";
        }
    }

</script>

